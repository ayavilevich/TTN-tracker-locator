(this["webpackJsonpttn-tracker-locator"]=this["webpackJsonpttn-tracker-locator"]||[]).push([[0],{228:function(e,t,a){e.exports=a(438)},233:function(e,t,a){},438:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),i=a(13),r=a.n(i),l=(a(233),a(14)),c=a(15),s=a(29),u=a(28),d=a(38),p=a(39),m=a(444),g=a(44),h=a(448),f=(a(234),a(195)),v=a(440),E=a(449),T=a(450),y=a(451),A=a(452),b=a(453),O=a(454),D=a(455),C=a(456),S=a(131),k=a(59),x=a(196);function w(e){return function(){return o.a.createElement(v.a,{component:function(){return o.a.createElement(S.a,{icon:e})}})}}var I=w(k.e),U=E.a,P=T.a,_=w(k.c),M=y.a,L=A.a,j=b.a,R=O.a,F=D.a,N=w(x.a),K=w(k.f),B=w(k.a),V=w(k.d),H=C.a,z=w(k.c),Q=(S.a,a(446)),Y=a(197),G=a.n(Y),W=a(163),X=a(4),Z=a.n(X),q=(Z.a.arrayOf(Z.a.shape({time:Z.a.instanceOf(Date).isRequired,deviceId:Z.a.string,altitude:Z.a.number,latitude:Z.a.number,longitude:Z.a.number,hdop:Z.a.number,sats:Z.a.number})),Z.a.arrayOf(Z.a.shape({time:Z.a.instanceOf(Date).isRequired,deviceId:Z.a.string,altitude:Z.a.number,latitude:Z.a.number.isRequired,longitude:Z.a.number.isRequired,hdop:Z.a.number,sats:Z.a.number})),function(){function e(){Object(l.a)(this,e)}return Object(c.a)(e,null,[{key:"normalizeHeading",value:function(e){return e>180?e-360:e<-180?e+360:e}}]),e}()),J=a(70),$={DATA_SOURCE:{TTN:"ttn",CUSTOM:"custom"},DEFAULT_MAP_CENTER:{LATITUDE:8.990553,LONGITUDE:-79.590706},DEFAULT_MAP_ZOOM:16},ee=function(e){Object(s.a)(a,e);var t=Object(u.a)(a);function a(){return Object(l.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e,t=this.props,a=t.google,n=(t.apiKey,t.latitude),i=t.longitude,r=t.heading,l=t.points.map((function(e){return{lng:e.longitude,lat:e.latitude}}));e=!1!==i&&!1!==n?{lat:n,lng:i}:l.length>0?l[l.length-1]:{lng:$.DEFAULT_MAP_CENTER.LONGITUDE,lat:$.DEFAULT_MAP_CENTER.LATITUDE};var c=new a.maps.LatLngBounds;return l.forEach((function(t){c.extend(t),c.extend({lat:2*e.lat-t.lat,lng:2*e.lng-t.lng})})),o.a.createElement(o.a.Fragment,null,a&&o.a.createElement(J.Map,{google:a,bounds:l.length>0?c:void 0,center:l.length>0?void 0:e,zoom:l.length>0?void 0:$.DEFAULT_MAP_ZOOM,zoomControl:!1,mapTypeControl:!1,fullscreenControl:!1,streetViewControl:!1,scrollwheel:!1,draggable:!1,keyboardShortcuts:!1,disableDoubleClickZoom:!0},!1!==i&&!1!==n&&!1!==r&&o.a.createElement(J.Marker,{name:"Your location with heading",position:{lat:n,lng:i},zIndex:a.maps.Marker.MAX_ZINDEX+1,icon:{path:a.maps.SymbolPath.FORWARD_CLOSED_ARROW,scale:5,fillColor:"white",fillOpacity:.5,strokeColor:"black",strokeWeight:3,rotation:r,anchor:new a.maps.Point(0,2.6)}}),!1!==i&&!1!==n&&!1===r&&o.a.createElement(J.Marker,{name:"Your location",position:{lat:n,lng:i},zIndex:a.maps.Marker.MAX_ZINDEX+1,icon:{path:a.maps.SymbolPath.CIRCLE,scale:8,fillColor:"white",fillOpacity:.5,strokeColor:"black",strokeWeight:3,anchor:new a.maps.Point(0,0)}}),l.length>0&&o.a.createElement(J.Marker,{name:"Target location",position:l[l.length-1],icon:{path:a.maps.SymbolPath.CIRCLE,scale:8,fillColor:"white",fillOpacity:.5,strokeColor:"green",strokeWeight:3,anchor:new a.maps.Point(0,0)}}),o.a.createElement(J.Polyline,{path:l,strokeColor:"#0000FF",strokeOpacity:.8,strokeWeight:2})))}}]),a}(o.a.Component);ee.defaultProps={longitude:!1,latitude:!1,heading:!1};var te=Object(J.GoogleApiWrapper)((function(e){return{apiKey:e.apiKey}}))(ee),ae=a(46),ne=a(26),oe=30,ie=.1,re={"line-color":"#4790E5","line-width":6},le={"circle-radius":10,"circle-color":"#00AA00","circle-opacity":.8};var ce=function(e){Object(s.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).map=null,n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){var e=this.props.accessToken;this.MapBox=Object(ae.d)({accessToken:e,interactive:!1}),this.accessToken=e,console.log("componentDidMount",this.props,this.MapBox)}},{key:"componentDidUpdate",value:function(e){var t=this.props.accessToken;e.accessToken!==t&&(this.MapBox=Object(ae.d)({accessToken:t}),this.accessToken=t,console.log("componentDidUpdate",t,this.MapBox))}},{key:"render",value:function(){var e,t=this,a=this.props,n=a.accessToken,i=a.latitude,r=a.longitude,l=a.heading,c=a.points.map((function(e){return[e.longitude,e.latitude]}));e=!1!==r&&!1!==i?[r,i]:c.length>0?c[c.length-1]:[$.DEFAULT_MAP_CENTER.LONGITUDE,$.DEFAULT_MAP_CENTER.LATITUDE];var s=$.DEFAULT_MAP_ZOOM;return this.map&&c.length>0&&(s=function(e,t,a){var n=e.transform,o=n.project(ne.LngLat.convert(t)),i=0;if(a.forEach((function(e){var t=n.project(ne.LngLat.convert(e)).dist(o);i=Math.max(i,t)})),0===i)return $.DEFAULT_MAP_ZOOM;var r=n.width*ie,l=n.height*ie,c=(n.width-2*r)/(2*i),s=(n.height-2*l)/(2*i);if(s<0||c<0)return console.warn("Map cannot fit within canvas with the given bounds, padding, and/or offset."),$.DEFAULT_MAP_ZOOM;var u=oe;return Math.min(n.scaleZoom(n.scale*Math.min(c,s)),u)}(this.map,e,c)),o.a.createElement(o.a.Fragment,null,this.MapBox&&this.accessToken===n&&o.a.createElement(this.MapBox,{style:"mapbox://styles/mapbox/streets-v11",containerStyle:{height:"100%",width:"100%"},center:e,bearing:[l||0],zoom:[s],movingMethod:"jumpTo"},o.a.createElement(ae.c.Consumer,null,(function(e){t.map=e})),!1!==r&&!1!==i&&o.a.createElement(ae.b,{type:"symbol",id:"me",layout:{"icon-image":"harbor-15"}},o.a.createElement(ae.a,{coordinates:[r,i]})),c.length>0&&o.a.createElement(ae.b,{type:"circle",id:"target",paint:le},o.a.createElement(ae.a,{coordinates:c[c.length-1]})),o.a.createElement(ae.b,{type:"line",id:"path",paint:re},o.a.createElement(ae.a,{coordinates:c}))))}}]),a}(o.a.Component);ce.defaultProps={longitude:!1,latitude:!1,heading:!1};var se=ce,ue=a(445),de=function(e){Object(s.a)(a,e);var t=Object(u.a)(a);function a(){return Object(l.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this.props.direction,t="-",a=o.a.createElement(F,null);return!1!==e&&(t=e>180?e-360:e,a=o.a.createElement(L,null),t<-45&&(a=o.a.createElement(j,null)),t>45&&(a=o.a.createElement(R,null))),o.a.createElement(ue.a,{title:"Direction to target",value:t,precision:1,prefix:a,suffix:"\xb0"})}}]),a}(o.a.Component);de.defaultProps={direction:!1};var pe=de,me=function(e){Object(s.a)(a,e);var t=Object(u.a)(a);function a(){return Object(l.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this.props.distance,t=e,a="m",n=o.a.createElement(N,null);return e>100&&(n=o.a.createElement(K,null)),e>1e3&&(n=o.a.createElement(B,null)),e>2e5&&(n=o.a.createElement(V,null)),e>500&&(t/=1e3,a="km"),o.a.createElement(ue.a,{title:"Distance to target",value:t,precision:1,prefix:n,suffix:a})}}]),a}(o.a.Component),ge=a(68),he=a.n(ge),fe=a(200);a.n(fe)()(he.a);var ve=1e3,Ee=function(e){Object(s.a)(a,e);var t=Object(u.a)(a);function a(e){var n;Object(l.a)(this,a),(n=t.call(this,e)).updateAge=function(){var e=n.props.lastUpdateTime;n.setState({age:he.a.duration(he()().diff(e))})};var o=n.props.lastUpdateTime;return n.state={age:he.a.duration(he()().diff(o))},n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){this.timer=setInterval(this.updateAge,ve)}},{key:"componentWillUnmount",value:function(){this.timer&&(clearInterval(this.timer),this.timer=null)}},{key:"render",value:function(){var e=this.props.hasFix,t=this.state.age.format(),a=e?o.a.createElement(_,null):o.a.createElement(M,null);return o.a.createElement(ue.a,{title:"Age of target position",value:t,prefix:a})}}]),a}(o.a.Component);function Te(){var e=Object(d.a)(["\n\tdisplay: inline-block;\n\tpadding: 4px 15px;\n\tbackground: #fff;\n\tborder: 1px solid #d9d9d9;\n\twhite-space: nowrap;\n"]);return Te=function(){return e},e}function ye(){var e=Object(d.a)(["\n\tposition: absolute;\n\tbottom: 2vh;\n\tdisplay: flex;\n\twidth: 100%;\n\tflex-flow: row wrap;\n\tjustify-content: center;\n"]);return ye=function(){return e},e}function Ae(){var e=Object(d.a)(["\n\tposition: absolute;\n\tleft: 2vw;\n\ttop: 10vh;\n"]);return Ae=function(){return e},e}function be(){var e=Object(d.a)(["\n\twidth: 100vw;\n\theight: 100vh;\n"]);return be=function(){return e},e}var Oe,De=100,Ce=p.a.div(be()),Se=p.a.div(Ae()),ke=p.a.div(ye()),xe=p.a.div(Te());Oe=window.screen.width>window.screen.height?"landscape":"portrait";var we=function(e){Object(s.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).handleHeadingChange=function(e){console.log("heading",e);var t=e.alpha;if("undefined"!==typeof e.webkitCompassHeading)t=e.webkitCompassHeading;else if(!e.absolute)return;var a=window.screen.orientation&&window.screen.orientation.type?window.screen.orientation.type:window.screen.orientation||window.screen.mozOrientation||window.screen.msOrientation;if("undefined"!==typeof t&&null!==t){var o=0;if("landscape"===Oe&&(o-=90),"undefined"!==typeof a){var i=a.split("-");Oe!==i[0]&&(o-="landscape"===Oe?270:90),"secondary"===i[1]&&(o-=180)}console.log("Heading",t,o,a,Oe,-t-o),n.setState({heading:q.normalizeHeading(-t-o)})}else console.log("No heading"),n.setState({heading:!1})},n.handleLocationUpdate=function(e){console.log("pos",e.coords);var t=e.coords,a=t.latitude,o=t.longitude;n.setState({latitude:a,longitude:o})},n.handleLocationUpdateFail=function(e){console.log("location fail: ",e),n.setState({latitude:!1,longitude:!1})},n.state={heading:!1,latitude:!1,longitude:!1},n.watchPositionId=null,n.throttledHandleHeadingChange=G()(n.handleHeadingChange,De),n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){window.addEventListener("deviceorientation",this.throttledHandleHeadingChange),window.addEventListener("deviceorientationabsolute",this.throttledHandleHeadingChange),this.watchPositionId=navigator.geolocation.watchPosition(this.handleLocationUpdate,this.handleLocationUpdateFail,{enableHighAccuracy:!0,maximumAge:3e4,timeout:27e3})}},{key:"componentDidCatch",value:function(e,t){console.log("componentDidCatch",e,t)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("deviceorientation",this.throttledHandleHeadingChange),window.removeEventListener("deviceorientationabsolute",this.throttledHandleHeadingChange),navigator.geolocation.clearWatch(this.watchPositionId),this.watchPositionId=null}},{key:"render",value:function(){var e=this.props,t=e.googleApiKey,a=e.mapBoxAccessToken,n=e.points,i=e.maxPointsToRenderOnMap,r=this.state,l=r.latitude,c=r.longitude,s=r.heading,u=n.filter((function(e){return"number"===typeof e.latitude&&"number"===typeof e.longitude})),d=[];n.length&&(d=n.length>i?u.slice(-i):u);var p=d.length>0&&d[d.length-1],m=n.length>0&&n[n.length-1],g=!1,h=!1;if(!1!==l&&!1!==c&&p){var f=new W.a(l,c),v=new W.a(p.latitude,p.longitude);g=f.distanceTo(v),!1!==s&&(h=f.initialBearingTo(v),console.log("direction to target",{bearing:h,heading:s}),h=q.normalizeHeading(h-s))}return o.a.createElement(Ce,null,a&&o.a.createElement(se,{accessToken:a,latitude:l,longitude:c,heading:s,points:d}),!a&&t&&o.a.createElement(te,{apiKey:t,latitude:l,longitude:c,heading:s,points:d}),!t&&!a&&o.a.createElement(Q.a,{message:"No map API keys specified in Settings",type:"error"}),o.a.createElement(ke,null,!1!==g&&o.a.createElement(o.a.Fragment,null,o.a.createElement(xe,null,o.a.createElement(me,{distance:g})),o.a.createElement(xe,null,o.a.createElement(pe,{direction:h})),o.a.createElement(xe,null,o.a.createElement(Ee,{lastUpdateTime:m.time,hasFix:!1!==m.latitude&&!1!==m.longitude})))),o.a.createElement(Se,null,!1===s&&o.a.createElement(Q.a,{message:"Your heading is not available",type:"warning"}),(!1===l||!1===c)&&o.a.createElement(Q.a,{message:"Your location is not available",type:"warning"}),0===n.length&&o.a.createElement(Q.a,{message:"Target location is not available",type:"warning"})))}}]),a}(o.a.Component);we.defaultProps={mapBoxAccessToken:"",googleApiKey:""};var Ie=we,Ue=a(442),Pe=a(443),_e=a(124),Me=a(447),Le=a(86);function je(){var e=Object(d.a)(["\n\tmargin: 0.3em;\n"]);return je=function(){return e},e}var Re=Object(p.a)(H)(je()),Fe=function(e){var t=e.label,a=e.tooltip;return o.a.createElement(o.a.Fragment,null,o.a.createElement("span",null,t)," ",o.a.createElement(Le.a,{title:a},o.a.createElement(Re,null)))};function Ne(){var e=Object(d.a)(["\n\t@media (min-width: 576px) {\n\t\twidth: 45em;\n\t}\n"]);return Ne=function(){return e},e}var Ke={DEFAULT_DATA_SOURCE:$.DATA_SOURCE.TTN,DEFAULT_CORS_PROXY:"https://cors-anywhere.herokuapp.com/",DEFAULT_QUERY_LAST:"10m",DEFAULT_MAX_POINTS:10},Be=Object(p.a)(Ue.a)(Ne()),Ve=function(e){var t=e.getFieldValue;return{validator:function(e,a){return a||t("dataSource")!==$.DATA_SOURCE.TTN?Promise.resolve():Promise.reject(Error(""))},message:"Value must be provided if data source is TTN"}},He=function(e){Object(s.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).onFinish=function(e){var t=n.props.onFinish;console.log("Success:",e),t(e)},n.onFinishFailed=function(e){console.log("Failed:",e)},n.onValuesChange=function(e,t){console.log("onValuesChange:",e,t),"string"===typeof e.dataSource&&n.setState({dataSource:e.dataSource})},n.state={dataSource:e.dataSource},n}return Object(c.a)(a,[{key:"render",value:function(){var e=this,t=this.props,a=t.googleApiKey,n=t.mapBoxAccessToken,i=t.serializedSettings,r=t.customDataUrl,l=t.ttnApplicationId,c=t.ttnDeviceId,s=t.ttnAccessKey,u=t.ttnCorsProxyUrl,d=t.ttnQueryLast,p=t.maxPointsToRenderOnMap,m=this.state.dataSource;return o.a.createElement(o.a.Fragment,null,o.a.createElement(Be,{name:"basic",labelCol:{span:12},wrapperCol:{span:12},onFinish:this.onFinish,onFinishFailed:this.onFinishFailed,onValuesChange:this.onValuesChange},o.a.createElement(Ue.a.Item,{label:o.a.createElement(Fe,{label:"MapBox access token",tooltip:"This is the preferred type of map that rotates in sync with your heading"}),name:"mapBoxAccessToken",initialValue:n,dependencies:["googleApiKey"],rules:[function(e){var t=e.getFieldValue;return{validator:function(e,a){return a||t("googleApiKey")?Promise.resolve():Promise.reject(Error(""))},message:"Please specify at least one map API key"}}]},o.a.createElement(Pe.a,{placeholder:"pk...."})),o.a.createElement(Ue.a.Item,{label:o.a.createElement(Fe,{label:"Google API key",tooltip:"This is another type of map that can be used"}),name:"googleApiKey",initialValue:a,dependencies:["mapBoxAccessToken"],rules:[function(e){var t=e.getFieldValue;return{validator:function(e,a){return a||t("mapBoxAccessToken")?Promise.resolve():Promise.reject(Error(""))},message:"Please specify at least one map API key"}}]},o.a.createElement(Pe.a,{placeholder:"Axxxx...xxx_xxx...xxx"})),o.a.createElement(Ue.a.Item,{label:"Data source",name:"dataSource",initialValue:m},o.a.createElement(_e.default.Group,{value:m},o.a.createElement(_e.default.Button,{value:$.DATA_SOURCE.TTN},"TTN"),o.a.createElement(_e.default.Button,{value:$.DATA_SOURCE.CUSTOM},"Custom"))),o.a.createElement(Ue.a.Item,{label:"Custom data url",name:"customDataUrl",initialValue:r,hidden:m!==$.DATA_SOURCE.CUSTOM},o.a.createElement(Pe.a,null)),o.a.createElement(Ue.a.Item,{label:o.a.createElement(Fe,{label:"CORS proxy for TTN",tooltip:"You can run your own, see cors-anywhere@github"}),name:"ttnCorsProxyUrl",initialValue:u,hidden:m!==$.DATA_SOURCE.TTN,dependencies:["dataSource"],rules:[Ve]},o.a.createElement(Pe.a,null)),o.a.createElement(Ue.a.Item,{label:o.a.createElement(Fe,{label:"TTN application id",tooltip:"The id of your TTN application, has to be integrated with the Data Storage integration"}),name:"ttnApplicationId",initialValue:l,hidden:m!==$.DATA_SOURCE.TTN,dependencies:["dataSource"],rules:[Ve]},o.a.createElement(Pe.a,null)),o.a.createElement(Ue.a.Item,{label:o.a.createElement(Fe,{label:"TTN device id",tooltip:"The id of the device you want to locate"}),name:"ttnDeviceId",initialValue:c,hidden:m!==$.DATA_SOURCE.TTN,dependencies:["dataSource"],rules:[Ve]},o.a.createElement(Pe.a,null)),o.a.createElement(Ue.a.Item,{label:o.a.createElement(Fe,{label:"TTN access key",tooltip:"Access key for the TTN application, you can generate a specific one for this use case in the console"}),name:"ttnAccessKey",initialValue:s,hidden:m!==$.DATA_SOURCE.TTN,dependencies:["dataSource"],rules:[Ve]},o.a.createElement(Pe.a,{placeholder:"ttn-account-v2...."})),o.a.createElement(Ue.a.Item,{label:o.a.createElement(Fe,{label:"TTN query 'last'",tooltip:"Duration on which we want to get the data. Examples: 30s, 10m, 1h, 2d, etc"}),name:"ttnQueryLast",initialValue:d,hidden:m!==$.DATA_SOURCE.TTN,dependencies:["dataSource"],rules:[Ve]},o.a.createElement(Pe.a,null)),o.a.createElement(Ue.a.Item,{label:o.a.createElement(Fe,{label:"Max number of points to render on map",tooltip:"If data source returned more samples then the newest will be rendered"}),name:"maxPointsToRenderOnMap",initialValue:p,rules:[{required:!0,message:"Please set number of points!"}]},o.a.createElement(Me.a,{min:1,max:100})),o.a.createElement(Ue.a.Item,{wrapperCol:{sm:{offset:12,span:12},xs:{offset:0,span:12}}},o.a.createElement(o.a.Fragment,null,o.a.createElement(g.a,{type:"primary",htmlType:"submit"},"Save"),o.a.createElement(g.a,{onClick:function(){(0,e.props.onFinish)()}},"Cancel")))),o.a.createElement("a",{href:"#".concat(i)},"Direct url to current configuration"))}}]),a}(o.a.Component);He.defaultProps={mapBoxAccessToken:"",googleApiKey:"",dataSource:Ke.DEFAULT_DATA_SOURCE,customDataUrl:"",ttnApplicationId:"",ttnDeviceId:"",ttnAccessKey:"",ttnCorsProxyUrl:Ke.DEFAULT_CORS_PROXY,ttnQueryLast:Ke.DEFAULT_QUERY_LAST,maxPointsToRenderOnMap:Ke.DEFAULT_MAX_POINTS};var ze=He,Qe=a(441),Ye=[{title:"Time",dataIndex:"time",key:"time",render:function(e){return e.toLocaleString()},defaultSortOrder:"descend",sorter:function(e,t){return e.time-t.time}},{title:"Latitude",dataIndex:"latitude",key:"latitude"},{title:"Longitude",dataIndex:"longitude",key:"longitude"},{title:"Altitude",dataIndex:"altitude",key:"altitude"},{title:"HDOP",dataIndex:"hdop",key:"hdop",sorter:function(e,t){return e.hdop-t.hdop}},{title:"Satelites",dataIndex:"sats",key:"sats",sorter:function(e,t){return e.sats-t.sats}},{title:"Device Id",dataIndex:"deviceId",key:"deviceId",sorter:function(e,t){return e.deviceId.localeCompare(t.deviceId)}},{title:"Map",key:"actions",render:function(e,t){return o.a.createElement(o.a.Fragment,null,t.latitude&&t.longitude&&o.a.createElement(Le.a,{title:"Open in Google maps"},o.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"http://maps.google.com/maps?z=15&q=loc:".concat(t.latitude,"+").concat(t.longitude)},o.a.createElement(z,null))))}}],Ge=function(e){Object(s.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).state={},n}return Object(c.a)(a,[{key:"render",value:function(){var e=this.props.points;return o.a.createElement(Qe.a,{dataSource:e,columns:Ye})}}]),a}(o.a.Component);Ge.defaultProps={points:[]};var We=Ge,Xe="ttn_",Ze={GOOGLE_API_KEY:"googleApiKey",MAP_BOX_ACCESS_TOKEN:"mapBoxAccessToken",DATA_SOURCE:"dataSource",CUSTOM_DATA_URL:"customDataUrl",TTN_APPLICATION_ID:"ttnApplicationId",TTN_DEVICE_ID:"ttnDeviceId",TTN_ACCESS_KEY:"ttnAccessKey",TTN_CORS_PROXY_URL:"ttnCorsProxyUrl",TTN_QUERY_LAST:"ttnQueryLast",MAX_POINTS_TO_RENDER_ON_MAP:"maxPointsToRenderOnMap"};function qe(e){return"".concat(Xe).concat(e)}function Je(e){return e.charAt(0).toUpperCase()+e.slice(1)}var $e=function(){function e(){Object(l.a)(this,e)}return Object(c.a)(e,null,[{key:"serialize",value:function(){var e=[];return Object.values(Ze).forEach((function(t){var a=localStorage.getItem(qe(t));null!==a&&""!==a&&void 0!==a&&e.push("".concat(t,"=").concat(encodeURIComponent(a)))})),e.join("&")}},{key:"deserialize",value:function(e){var t=e.split("&"),a=Object.values(Ze);t.forEach((function(e){var t=e.split("=");2===t.length&&a.includes(t[0])&&localStorage.setItem(qe(t[0]),decodeURIComponent(t[1]))}))}}]),e}();Object.values(Ze).forEach((function(e){$e["get".concat(Je(e))]=function(){return null===(t=localStorage.getItem(qe(e)))?void 0:t;var t},$e["set".concat(Je(e))]=function(t){return null!==t?localStorage.setItem(qe(e),t):localStorage.removeItem(qe(e))}}));var et=$e,tt=a(437),at=/^map\[(.*)\]$/,nt=function(){function e(){Object(l.a)(this,e)}return Object(c.a)(e,null,[{key:"preProcessSample",value:function(e){var t=e.latitude,a=e.longitude,n=e.altitude,o=e.gps_20,i=e.device_id,r=e.hdop,l=e.sats;if(o&&"string"===typeof o){var c=o.match(at);if(c){var s="{".concat(c[1],"}").replace(/ /g,", ");try{var u=tt.parse(s);n=u.altitude,t=u.latitude,a=u.longitude}catch(d){console.warn("error parsing LPP gsp payload",d,s)}}}return{time:new Date(e.time),deviceId:i,altitude:n,latitude:t,longitude:a,hdop:r,sats:l}}}]),e}();function ot(){var e=Object(d.a)(["\n\ttext-align: center;\n\tposition: absolute;\n\tz-index: 100;\n\twidth: 100%;\n"]);return ot=function(){return e},e}function it(){var e=Object(d.a)(["\n\ttext-align: center;\n\tbackground-color: #282c34;\n\tmin-height: 100vh;\n\tfont-size: calc(10px + 2vmin);\n\tcolor: white;\n"]);return it=function(){return e},e}var rt="settings",lt=p.a.div(it()),ct=p.a.nav(ot()),st=function(e){Object(s.a)(a,e);var t=Object(u.a)(a);function a(e){var n;Object(l.a)(this,a),(n=t.call(this,e)).handleSettingsFinish=function(e){var t=n.state.googleApiKey;if(e){if(et.setGoogleApiKey(e.googleApiKey),et.setMapBoxAccessToken(e.mapBoxAccessToken),et.setDataSource(e.dataSource),et.setCustomDataUrl(e.customDataUrl),et.setTtnApplicationId(e.ttnApplicationId),et.setTtnDeviceId(e.ttnDeviceId),et.setTtnAccessKey(e.ttnAccessKey),et.setTtnCorsProxyUrl(e.ttnCorsProxyUrl),et.setTtnQueryLast(e.ttnQueryLast),et.setMaxPointsToRenderOnMap(e.maxPointsToRenderOnMap),t!==e.googleApiKey)return console.log("handleSettingsFinish, reload"),void window.location.reload();n.setState({settingsVisible:!1,googleApiKey:e.googleApiKey,mapBoxAccessToken:e.mapBoxAccessToken,dataSource:e.dataSource,customDataUrl:e.customDataUrl,ttnApplicationId:e.ttnApplicationId,ttnDeviceId:e.ttnDeviceId,ttnAccessKey:e.ttnAccessKey,ttnCorsProxyUrl:e.ttnCorsProxyUrl,ttnQueryLast:e.ttnQueryLast,maxPointsToRenderOnMap:e.maxPointsToRenderOnMap})}else n.setState({settingsVisible:!1})},n.handleLoadData=function(){n.state.loadingData||(console.log("handle fetch"),n.setState({loadingData:!0}),n.fetchData().then((function(e){return e.ok?204===e.status?[]:e.json():(0===e.status?m.a.error({message:"Unable to get response",description:"Are there CORS limitations in place?"}):m.a.error({message:"Error code reported",description:e.statusText}),n.setState({loadingData:!1}),null)})).then((function(e){e&&n.processLocationData(e),n.setState({loadingData:!1})})).catch((function(e){console.error(e),m.a.error({message:"Error loading data",description:e.toString()}),n.setState({loadingData:!1})})))};var o=new f.a;if(o.has(rt)){var i=o.getValue(rt);console.log("loading settings from hash",i),et.deserialize(decodeURIComponent(i))}var r=et.getMaxPointsToRenderOnMap();return n.state={loadingData:!1,settingsVisible:!1,pointsTableVisible:!1,points:[],googleApiKey:et.getGoogleApiKey(),mapBoxAccessToken:et.getMapBoxAccessToken(),dataSource:et.getDataSource(),customDataUrl:et.getCustomDataUrl(),ttnApplicationId:et.getTtnApplicationId(),ttnDeviceId:et.getTtnDeviceId(),ttnAccessKey:et.getTtnAccessKey(),ttnCorsProxyUrl:et.getTtnCorsProxyUrl(),ttnQueryLast:et.getTtnQueryLast(),maxPointsToRenderOnMap:void 0!==r?parseInt(r,10):r},n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){this.handleLoadData()}},{key:"processLocationData",value:function(e){console.log("Got data",e.length,e);try{var t=e.map(nt.preProcessSample);this.setState({points:t})}catch(a){m.a.error({message:"Error parsing data",description:a.toString()})}}},{key:"fetchData",value:function(){var e=this.state,t=e.dataSource,a=e.customDataUrl,n=e.ttnApplicationId,o=e.ttnDeviceId,i=e.ttnAccessKey,r=e.ttnCorsProxyUrl,l=e.ttnQueryLast;if(t===$.DATA_SOURCE.CUSTOM)return fetch(a,{});if(t===$.DATA_SOURCE.TTN){var c=new Headers;return c.append("Accept","application/json"),c.append("Authorization","key ".concat(i)),fetch("".concat(r,"https://").concat(n,".data.thethingsnetwork.org/api/v2/query/").concat(o,"?last=").concat(l),{headers:c})}return new Promise((function(e,t){t(new Error("Data source is not configured"))}))}},{key:"render",value:function(){var e=this,t=this.state,a=t.loadingData,n=t.settingsVisible,i=t.pointsTableVisible,r=t.points,l=t.googleApiKey,c=t.mapBoxAccessToken,s=t.dataSource,u=t.customDataUrl,d=t.ttnApplicationId,p=t.ttnDeviceId,m=t.ttnAccessKey,f=t.ttnCorsProxyUrl,v=t.ttnQueryLast,E=t.maxPointsToRenderOnMap;return o.a.createElement(lt,null,o.a.createElement(ct,null,o.a.createElement(g.a,{loading:a,onClick:this.handleLoadData,icon:o.a.createElement(U,null)},"Reload data"),o.a.createElement(h.a,{placement:"bottom",title:"Data",visible:i,content:o.a.createElement(We,{points:r}),trigger:"click",onVisibleChange:function(t){e.setState({pointsTableVisible:t})}},o.a.createElement(g.a,{icon:o.a.createElement(I,null)},"Data")),o.a.createElement(h.a,{placement:"bottom",title:"Settings",visible:n,content:o.a.createElement(ze,{onFinish:this.handleSettingsFinish,serializedSettings:"".concat(rt,"=").concat(encodeURIComponent(et.serialize())),googleApiKey:l,mapBoxAccessToken:c,dataSource:s,customDataUrl:u,ttnApplicationId:d,ttnDeviceId:p,ttnAccessKey:m,ttnCorsProxyUrl:f,ttnQueryLast:v,maxPointsToRenderOnMap:E}),trigger:"click",onVisibleChange:function(){e.setState({settingsVisible:!0})}},o.a.createElement(g.a,{icon:o.a.createElement(P,null)},"Settings"))),o.a.createElement(Ie,{googleApiKey:l,mapBoxAccessToken:c,points:r,maxPointsToRenderOnMap:E}))}}]),a}(o.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(st,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[228,1,2]]]);
//# sourceMappingURL=main.9a22702d.chunk.js.map