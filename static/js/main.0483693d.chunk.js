(this["webpackJsonpttn-tracker-locator"]=this["webpackJsonpttn-tracker-locator"]||[]).push([[0],{229:function(e,t,a){e.exports=a(439)},234:function(e,t,a){},439:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),i=a(13),r=a.n(i),l=(a(234),a(14)),c=a(15),s=a(29),u=a(28),d=a(38),p=a(39),m=a(445),g=a(44),h=a(449),f=(a(235),a(196)),E=a(441),T=a(450),v=a(451),y=a(452),A=a(453),O=a(454),b=a(455),D=a(456),S=a(457),C=a(131),_=a(59),k=a(197);function I(e){return function(){return o.a.createElement(E.a,{component:function(){return o.a.createElement(C.a,{icon:e})}})}}var U=I(_.e),x=T.a,w=v.a,L=I(_.c),P=y.a,M=A.a,j=O.a,R=b.a,F=D.a,N=I(k.a),K=I(_.f),B=I(_.a),V=I(_.d),z=S.a,H=I(_.c),G=(C.a,a(163)),X=a(447),Y=a(198),Q=a.n(Y),Z=a(164),W=a(4),q=a.n(W),J=(q.a.arrayOf(q.a.shape({time:q.a.instanceOf(Date).isRequired,deviceId:q.a.string,altitude:q.a.number,latitude:q.a.number,longitude:q.a.number,hdop:q.a.number,sats:q.a.number})),q.a.arrayOf(q.a.shape({time:q.a.instanceOf(Date).isRequired,deviceId:q.a.string,altitude:q.a.number,latitude:q.a.number.isRequired,longitude:q.a.number.isRequired,hdop:q.a.number,sats:q.a.number})),function(){function e(){Object(l.a)(this,e)}return Object(c.a)(e,null,[{key:"normalizeHeading",value:function(e){return e>180?e-360:e<-180?e+360:e}}]),e}()),$=a(70),ee={DATA_SOURCE:{TTN:"ttn",CUSTOM:"custom"},DEFAULT_MAP_CENTER:{LATITUDE:8.990553,LONGITUDE:-79.590706},DEFAULT_MAP_ZOOM:16},te=function(e){Object(s.a)(a,e);var t=Object(u.a)(a);function a(){return Object(l.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e,t=this.props,a=t.google,n=(t.apiKey,t.latitude),i=t.longitude,r=t.heading,l=t.points.map((function(e){return{lng:e.longitude,lat:e.latitude}}));e=!1!==i&&!1!==n?{lat:n,lng:i}:l.length>0?l[l.length-1]:{lng:ee.DEFAULT_MAP_CENTER.LONGITUDE,lat:ee.DEFAULT_MAP_CENTER.LATITUDE};var c=new a.maps.LatLngBounds;return l.forEach((function(t){c.extend(t),c.extend({lat:2*e.lat-t.lat,lng:2*e.lng-t.lng})})),o.a.createElement(o.a.Fragment,null,a&&o.a.createElement($.Map,{google:a,bounds:l.length>0?c:void 0,center:l.length>0?void 0:e,zoom:l.length>0?void 0:ee.DEFAULT_MAP_ZOOM,zoomControl:!1,mapTypeControl:!1,fullscreenControl:!1,streetViewControl:!1,scrollwheel:!1,draggable:!1,keyboardShortcuts:!1,disableDoubleClickZoom:!0},!1!==i&&!1!==n&&!1!==r&&o.a.createElement($.Marker,{name:"Your location with heading",position:{lat:n,lng:i},zIndex:a.maps.Marker.MAX_ZINDEX+1,icon:{path:a.maps.SymbolPath.FORWARD_CLOSED_ARROW,scale:5,fillColor:"white",fillOpacity:.5,strokeColor:"black",strokeWeight:3,rotation:r,anchor:new a.maps.Point(0,2.6)}}),!1!==i&&!1!==n&&!1===r&&o.a.createElement($.Marker,{name:"Your location",position:{lat:n,lng:i},zIndex:a.maps.Marker.MAX_ZINDEX+1,icon:{path:a.maps.SymbolPath.CIRCLE,scale:8,fillColor:"white",fillOpacity:.5,strokeColor:"black",strokeWeight:3,anchor:new a.maps.Point(0,0)}}),l.length>0&&o.a.createElement($.Marker,{name:"Target location",position:l[l.length-1],icon:{path:a.maps.SymbolPath.CIRCLE,scale:8,fillColor:"white",fillOpacity:.5,strokeColor:"green",strokeWeight:3,anchor:new a.maps.Point(0,0)}}),o.a.createElement($.Polyline,{path:l,strokeColor:"#0000FF",strokeOpacity:.8,strokeWeight:2})))}}]),a}(o.a.Component);te.defaultProps={longitude:!1,latitude:!1,heading:!1};var ae=Object($.GoogleApiWrapper)((function(e){return{apiKey:e.apiKey}}))(te),ne=a(46),oe=a(26),ie=30,re=.1,le={"line-color":"#4790E5","line-width":6},ce={"circle-radius":10,"circle-color":"#00AA00","circle-opacity":.8};var se=function(e){Object(s.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).map=null,n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){var e=this.props.accessToken;this.MapBox=Object(ne.d)({accessToken:e,interactive:!1}),this.accessToken=e,console.log("componentDidMount",this.props,this.MapBox)}},{key:"componentDidUpdate",value:function(e){var t=this.props.accessToken;e.accessToken!==t&&(this.MapBox=Object(ne.d)({accessToken:t}),this.accessToken=t,console.log("componentDidUpdate",t,this.MapBox))}},{key:"render",value:function(){var e,t=this,a=this.props,n=a.accessToken,i=a.latitude,r=a.longitude,l=a.heading,c=a.points.map((function(e){return[e.longitude,e.latitude]}));e=!1!==r&&!1!==i?[r,i]:c.length>0?c[c.length-1]:[ee.DEFAULT_MAP_CENTER.LONGITUDE,ee.DEFAULT_MAP_CENTER.LATITUDE];var s=ee.DEFAULT_MAP_ZOOM;return this.map&&c.length>0&&(s=function(e,t,a){var n=e.transform,o=n.project(oe.LngLat.convert(t)),i=0;if(a.forEach((function(e){var t=n.project(oe.LngLat.convert(e)).dist(o);i=Math.max(i,t)})),0===i)return ee.DEFAULT_MAP_ZOOM;var r=n.width*re,l=n.height*re,c=(n.width-2*r)/(2*i),s=(n.height-2*l)/(2*i);if(s<0||c<0)return console.warn("Map cannot fit within canvas with the given bounds, padding, and/or offset."),ee.DEFAULT_MAP_ZOOM;var u=ie;return Math.min(n.scaleZoom(n.scale*Math.min(c,s)),u)}(this.map,e,c)),o.a.createElement(o.a.Fragment,null,this.MapBox&&this.accessToken===n&&o.a.createElement(this.MapBox,{style:"mapbox://styles/mapbox/streets-v11",containerStyle:{height:"100%",width:"100%"},center:e,bearing:[l||0],zoom:[s],movingMethod:"jumpTo"},o.a.createElement(ne.c.Consumer,null,(function(e){t.map=e})),!1!==r&&!1!==i&&o.a.createElement(ne.b,{type:"symbol",id:"me",layout:{"icon-image":"harbor-15"}},o.a.createElement(ne.a,{coordinates:[r,i]})),c.length>0&&o.a.createElement(ne.b,{type:"circle",id:"target",paint:ce},o.a.createElement(ne.a,{coordinates:c[c.length-1]})),o.a.createElement(ne.b,{type:"line",id:"path",paint:le},o.a.createElement(ne.a,{coordinates:c}))))}}]),a}(o.a.Component);se.defaultProps={longitude:!1,latitude:!1,heading:!1};var ue=se,de=a(446),pe=function(e){Object(s.a)(a,e);var t=Object(u.a)(a);function a(){return Object(l.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this.props.direction,t="-",a=o.a.createElement(F,null);return!1!==e&&(t=e>180?e-360:e,a=o.a.createElement(M,null),t<-45&&(a=o.a.createElement(j,null)),t>45&&(a=o.a.createElement(R,null))),o.a.createElement(de.a,{title:"Direction to target",value:t,precision:1,prefix:a,suffix:"\xb0"})}}]),a}(o.a.Component);pe.defaultProps={direction:!1};var me=pe,ge=function(e){Object(s.a)(a,e);var t=Object(u.a)(a);function a(){return Object(l.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this.props.distance,t=e,a="m",n=o.a.createElement(N,null);return e>100&&(n=o.a.createElement(K,null)),e>1e3&&(n=o.a.createElement(B,null)),e>2e5&&(n=o.a.createElement(V,null)),e>500&&(t/=1e3,a="km"),o.a.createElement(de.a,{title:"Distance to target",value:t,precision:1,prefix:n,suffix:a})}}]),a}(o.a.Component),he=a(68),fe=a.n(he),Ee=a(201);a.n(Ee)()(fe.a);var Te=1e3,ve=function(e){Object(s.a)(a,e);var t=Object(u.a)(a);function a(e){var n;Object(l.a)(this,a),(n=t.call(this,e)).updateAge=function(){var e=n.props.lastUpdateTime;n.setState({age:fe.a.duration(fe()().diff(e))})};var o=n.props.lastUpdateTime;return n.state={age:fe.a.duration(fe()().diff(o))},n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){this.timer=setInterval(this.updateAge,Te)}},{key:"componentWillUnmount",value:function(){this.timer&&(clearInterval(this.timer),this.timer=null)}},{key:"render",value:function(){var e=this.props.hasFix,t=this.state.age.format(),a=e?o.a.createElement(L,null):o.a.createElement(P,null);return o.a.createElement(de.a,{title:"Age of target position",value:t,prefix:a})}}]),a}(o.a.Component);function ye(){var e=Object(d.a)(["\n\tdisplay: inline-block;\n\tpadding: 4px 15px;\n\tbackground: #fff;\n\tborder: 1px solid #d9d9d9;\n\twhite-space: nowrap;\n"]);return ye=function(){return e},e}function Ae(){var e=Object(d.a)(["\n\tposition: absolute;\n\tbottom: 2vh;\n\tdisplay: flex;\n\twidth: 100%;\n\tflex-flow: row wrap;\n\tjustify-content: center;\n"]);return Ae=function(){return e},e}function Oe(){var e=Object(d.a)(["\n\tposition: absolute;\n\tleft: 2vw;\n\ttop: 10vh;\n"]);return Oe=function(){return e},e}function be(){var e=Object(d.a)(["\n\twidth: 100vw;\n\theight: 100vh;\n"]);return be=function(){return e},e}var De,Se=100,Ce=p.a.div(be()),_e=p.a.div(Oe()),ke=p.a.div(Ae()),Ie=p.a.div(ye());De=window.screen.width>window.screen.height?"landscape":"portrait";var Ue=function(e){Object(s.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).handleHeadingChange=function(e){console.log("heading",e);var t=e.alpha;if("undefined"!==typeof e.webkitCompassHeading)t=e.webkitCompassHeading;else if(!e.absolute)return;var a=window.screen.orientation&&window.screen.orientation.type?window.screen.orientation.type:window.screen.orientation||window.screen.mozOrientation||window.screen.msOrientation;if("undefined"!==typeof t&&null!==t){var o=0;if("landscape"===De&&(o-=90),"undefined"!==typeof a){var i=a.split("-");De!==i[0]&&(o-="landscape"===De?270:90),"secondary"===i[1]&&(o-=180)}console.log("Heading",t,o,a,De,-t-o),n.setState({heading:J.normalizeHeading(-t-o)})}else console.log("No heading"),n.setState({heading:!1})},n.handleLocationUpdate=function(e){var t=e.coords,a=t.latitude,o=t.longitude;n.setState({latitude:a,longitude:o})},n.handleLocationUpdateFail=function(e){console.log("location fail: ",e),n.setState({latitude:!1,longitude:!1})},n.state={heading:!1,latitude:!1,longitude:!1},n.watchPositionId=null,n.throttledHandleHeadingChange=Q()(n.handleHeadingChange,Se),n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){window.addEventListener("deviceorientation",this.throttledHandleHeadingChange),window.addEventListener("deviceorientationabsolute",this.throttledHandleHeadingChange),this.watchPositionId=navigator.geolocation.watchPosition(this.handleLocationUpdate,this.handleLocationUpdateFail,{enableHighAccuracy:!0,maximumAge:3e4,timeout:27e3})}},{key:"componentDidCatch",value:function(e,t){console.log("componentDidCatch",e,t)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("deviceorientation",this.throttledHandleHeadingChange),window.removeEventListener("deviceorientationabsolute",this.throttledHandleHeadingChange),navigator.geolocation.clearWatch(this.watchPositionId),this.watchPositionId=null}},{key:"render",value:function(){var e=this.props,t=e.googleApiKey,a=e.mapBoxAccessToken,n=e.points,i=e.maxPointsToRenderOnMap,r=e.demoLatitudeOffset,l=e.demoLongitudeOffset,c=this.state,s=c.latitude,u=c.longitude,d=c.heading,p=n.filter((function(e){return"number"===typeof e.latitude&&"number"===typeof e.longitude})),m=[];n.length&&(m=n.length>i?p.slice(-i):p);var g=m.length>0&&Object(G.a)({},m[m.length-1]),h=n.length>0&&n[n.length-1];m=m.map((function(e){var t=Object(G.a)({},e);return t.latitude+=r,t.longitude+=l,t}));var f=!1,E=!1;if(!1!==s&&!1!==u&&g){var T=new Z.a(s,u),v=new Z.a(g.latitude,g.longitude);f=T.distanceTo(v),!1!==d&&(E=T.initialBearingTo(v),console.log("direction to target",{bearing:E,heading:d}),E=J.normalizeHeading(E-d))}return o.a.createElement(Ce,null,a&&o.a.createElement(ue,{accessToken:a,latitude:s+r,longitude:u+l,heading:d,points:m}),!a&&t&&o.a.createElement(ae,{apiKey:t,latitude:s+r,longitude:u+l,heading:d,points:m}),!t&&!a&&o.a.createElement(X.a,{message:"No map API keys specified in Settings",type:"error"}),o.a.createElement(ke,null,!1!==f&&o.a.createElement(o.a.Fragment,null,o.a.createElement(Ie,null,o.a.createElement(ge,{distance:f})),o.a.createElement(Ie,null,o.a.createElement(me,{direction:E})),o.a.createElement(Ie,null,o.a.createElement(ve,{lastUpdateTime:h.time,hasFix:!1!==h.latitude&&!1!==h.longitude})))),o.a.createElement(_e,null,!1===d&&o.a.createElement(X.a,{message:"Your heading is not available",type:"warning"}),(!1===s||!1===u)&&o.a.createElement(X.a,{message:"Your location is not available",type:"warning"}),0===n.length&&o.a.createElement(X.a,{message:"Target location is not available",type:"warning"})))}}]),a}(o.a.Component);Ue.defaultProps={mapBoxAccessToken:"",googleApiKey:"",demoLatitudeOffset:0,demoLongitudeOffset:0};var xe=Ue,we=a(443),Le=a(444),Pe=a(124),Me=a(448),je=a(86);function Re(){var e=Object(d.a)(["\n\tmargin: 0.3em;\n"]);return Re=function(){return e},e}var Fe=Object(p.a)(z)(Re()),Ne=function(e){var t=e.label,a=e.tooltip;return o.a.createElement(o.a.Fragment,null,o.a.createElement("span",null,t)," ",o.a.createElement(je.a,{title:a},o.a.createElement(Fe,null)))};function Ke(){var e=Object(d.a)(["\n\t@media (min-width: 576px) {\n\t\twidth: 45em;\n\t}\n"]);return Ke=function(){return e},e}var Be={DEFAULT_DATA_SOURCE:ee.DATA_SOURCE.TTN,DEFAULT_CORS_PROXY:"https://cors-anywhere.herokuapp.com/",DEFAULT_QUERY_LAST:"10m",DEFAULT_MAX_POINTS:10},Ve=Object(p.a)(we.a)(Ke()),ze=function(e){var t=e.getFieldValue;return{validator:function(e,a){return a||t("dataSource")!==ee.DATA_SOURCE.TTN?Promise.resolve():Promise.reject(Error(""))},message:"Value must be provided if data source is TTN"}},He=function(e){Object(s.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).onFinish=function(e){var t=n.props.onFinish;console.log("Success:",e),t(e)},n.onFinishFailed=function(e){console.log("Failed:",e)},n.onValuesChange=function(e,t){console.log("onValuesChange:",e,t),"string"===typeof e.dataSource&&n.setState({dataSource:e.dataSource})},n.state={dataSource:e.dataSource},n}return Object(c.a)(a,[{key:"render",value:function(){var e=this,t=this.props,a=t.googleApiKey,n=t.mapBoxAccessToken,i=t.serializedSettings,r=t.customDataUrl,l=t.ttnApplicationId,c=t.ttnDeviceId,s=t.ttnAccessKey,u=t.ttnCorsProxyUrl,d=t.ttnQueryLast,p=t.maxPointsToRenderOnMap,m=this.state.dataSource;return o.a.createElement(o.a.Fragment,null,o.a.createElement(Ve,{name:"basic",labelCol:{span:12},wrapperCol:{span:12},onFinish:this.onFinish,onFinishFailed:this.onFinishFailed,onValuesChange:this.onValuesChange},o.a.createElement(we.a.Item,{label:o.a.createElement(Ne,{label:"MapBox access token",tooltip:"This is the preferred type of map that rotates in sync with your heading"}),name:"mapBoxAccessToken",initialValue:n,dependencies:["googleApiKey"],rules:[function(e){var t=e.getFieldValue;return{validator:function(e,a){return a||t("googleApiKey")?Promise.resolve():Promise.reject(Error(""))},message:"Please specify at least one map API key"}}]},o.a.createElement(Le.a,{placeholder:"pk...."})),o.a.createElement(we.a.Item,{label:o.a.createElement(Ne,{label:"Google API key",tooltip:"This is another type of map that can be used"}),name:"googleApiKey",initialValue:a,dependencies:["mapBoxAccessToken"],rules:[function(e){var t=e.getFieldValue;return{validator:function(e,a){return a||t("mapBoxAccessToken")?Promise.resolve():Promise.reject(Error(""))},message:"Please specify at least one map API key"}}]},o.a.createElement(Le.a,{placeholder:"Axxxx...xxx_xxx...xxx"})),o.a.createElement(we.a.Item,{label:"Data source",name:"dataSource",initialValue:m},o.a.createElement(Pe.default.Group,{value:m},o.a.createElement(Pe.default.Button,{value:ee.DATA_SOURCE.TTN},"TTN"),o.a.createElement(Pe.default.Button,{value:ee.DATA_SOURCE.CUSTOM},"Custom"))),o.a.createElement(we.a.Item,{label:"Custom data url",name:"customDataUrl",initialValue:r,hidden:m!==ee.DATA_SOURCE.CUSTOM},o.a.createElement(Le.a,null)),o.a.createElement(we.a.Item,{label:o.a.createElement(Ne,{label:"CORS proxy for TTN",tooltip:"You can run your own, see cors-anywhere@github"}),name:"ttnCorsProxyUrl",initialValue:u,hidden:m!==ee.DATA_SOURCE.TTN,dependencies:["dataSource"],rules:[ze]},o.a.createElement(Le.a,null)),o.a.createElement(we.a.Item,{label:o.a.createElement(Ne,{label:"TTN application id",tooltip:"The id of your TTN application, has to be integrated with the Data Storage integration"}),name:"ttnApplicationId",initialValue:l,hidden:m!==ee.DATA_SOURCE.TTN,dependencies:["dataSource"],rules:[ze]},o.a.createElement(Le.a,null)),o.a.createElement(we.a.Item,{label:o.a.createElement(Ne,{label:"TTN device id",tooltip:"The id of the device you want to locate"}),name:"ttnDeviceId",initialValue:c,hidden:m!==ee.DATA_SOURCE.TTN,dependencies:["dataSource"],rules:[ze]},o.a.createElement(Le.a,null)),o.a.createElement(we.a.Item,{label:o.a.createElement(Ne,{label:"TTN access key",tooltip:"Access key for the TTN application, you can generate a specific one for this use case in the console"}),name:"ttnAccessKey",initialValue:s,hidden:m!==ee.DATA_SOURCE.TTN,dependencies:["dataSource"],rules:[ze]},o.a.createElement(Le.a,{placeholder:"ttn-account-v2...."})),o.a.createElement(we.a.Item,{label:o.a.createElement(Ne,{label:"TTN query 'last'",tooltip:"Duration on which we want to get the data. Examples: 30s, 10m, 1h, 2d, etc"}),name:"ttnQueryLast",initialValue:d,hidden:m!==ee.DATA_SOURCE.TTN,dependencies:["dataSource"],rules:[ze]},o.a.createElement(Le.a,null)),o.a.createElement(we.a.Item,{label:o.a.createElement(Ne,{label:"Max number of points to render on map",tooltip:"If data source returned more samples then the newest will be rendered"}),name:"maxPointsToRenderOnMap",initialValue:p,rules:[{required:!0,message:"Please set number of points!"}]},o.a.createElement(Me.a,{min:1,max:100})),o.a.createElement(we.a.Item,{wrapperCol:{sm:{offset:12,span:12},xs:{offset:0,span:12}}},o.a.createElement(o.a.Fragment,null,o.a.createElement(g.a,{type:"primary",htmlType:"submit"},"Save"),o.a.createElement(g.a,{onClick:function(){(0,e.props.onFinish)()}},"Cancel")))),o.a.createElement("a",{href:"#".concat(i)},"Direct url to current configuration"))}}]),a}(o.a.Component);He.defaultProps={mapBoxAccessToken:"",googleApiKey:"",dataSource:Be.DEFAULT_DATA_SOURCE,customDataUrl:"",ttnApplicationId:"",ttnDeviceId:"",ttnAccessKey:"",ttnCorsProxyUrl:Be.DEFAULT_CORS_PROXY,ttnQueryLast:Be.DEFAULT_QUERY_LAST,maxPointsToRenderOnMap:Be.DEFAULT_MAX_POINTS};var Ge=He,Xe=a(442),Ye=[{title:"Time",dataIndex:"time",key:"time",render:function(e){return e.toLocaleString()},defaultSortOrder:"descend",sorter:function(e,t){return e.time-t.time}},{title:"Latitude",dataIndex:"latitude",key:"latitude"},{title:"Longitude",dataIndex:"longitude",key:"longitude"},{title:"Altitude",dataIndex:"altitude",key:"altitude"},{title:"HDOP",dataIndex:"hdop",key:"hdop",sorter:function(e,t){return e.hdop-t.hdop}},{title:"Satelites",dataIndex:"sats",key:"sats",sorter:function(e,t){return e.sats-t.sats}},{title:"Device Id",dataIndex:"deviceId",key:"deviceId",sorter:function(e,t){return e.deviceId.localeCompare(t.deviceId)}},{title:"Map",key:"actions",render:function(e,t){return o.a.createElement(o.a.Fragment,null,t.latitude&&t.longitude&&o.a.createElement(je.a,{title:"Open in Google maps"},o.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"http://maps.google.com/maps?z=15&q=loc:".concat(t.latitude,"+").concat(t.longitude)},o.a.createElement(H,null))))}}],Qe=function(e){Object(s.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).state={},n}return Object(c.a)(a,[{key:"render",value:function(){var e=this.props.points;return o.a.createElement(Xe.a,{dataSource:e,columns:Ye,rowKey:"time"})}}]),a}(o.a.Component);Qe.defaultProps={points:[]};var Ze=Qe,We="ttn_",qe={GOOGLE_API_KEY:"googleApiKey",MAP_BOX_ACCESS_TOKEN:"mapBoxAccessToken",DATA_SOURCE:"dataSource",CUSTOM_DATA_URL:"customDataUrl",TTN_APPLICATION_ID:"ttnApplicationId",TTN_DEVICE_ID:"ttnDeviceId",TTN_ACCESS_KEY:"ttnAccessKey",TTN_CORS_PROXY_URL:"ttnCorsProxyUrl",TTN_QUERY_LAST:"ttnQueryLast",MAX_POINTS_TO_RENDER_ON_MAP:"maxPointsToRenderOnMap"};function Je(e){return"".concat(We).concat(e)}function $e(e){return e.charAt(0).toUpperCase()+e.slice(1)}var et=function(){function e(){Object(l.a)(this,e)}return Object(c.a)(e,null,[{key:"serialize",value:function(){var e=[];return Object.values(qe).forEach((function(t){var a=localStorage.getItem(Je(t));null!==a&&""!==a&&void 0!==a&&e.push("".concat(t,"=").concat(encodeURIComponent(a)))})),e.join("&")}},{key:"deserialize",value:function(e){var t=e.split("&"),a=Object.values(qe);t.forEach((function(e){var t=e.split("=");2===t.length&&a.includes(t[0])&&localStorage.setItem(Je(t[0]),decodeURIComponent(t[1]))}))}}]),e}();Object.values(qe).forEach((function(e){et["get".concat($e(e))]=function(){return null===(t=localStorage.getItem(Je(e)))?void 0:t;var t},et["set".concat($e(e))]=function(t){return null!==t?localStorage.setItem(Je(e),t):localStorage.removeItem(Je(e))}}));var tt=et,at=a(438),nt=/^map\[(.*)\]$/,ot=function(){function e(){Object(l.a)(this,e)}return Object(c.a)(e,null,[{key:"preProcessSample",value:function(e){var t,a,n;"number"===typeof e.altitude&&(t=e.altitude),"number"===typeof e.Altitude&&(t=e.Altitude),"number"===typeof e.latitude&&0!==e.latitude&&(a=e.latitude),"number"===typeof e.Latitude&&0!==e.Latitude&&(a=e.Latitude),"number"===typeof e.longitude&&0!==e.longitude&&(n=e.longitude),"number"===typeof e.Longitude&&0!==e.Longitude&&(n=e.Longitude);var o=e.gps_20,i=e.device_id,r=e.hdop,l=e.sats;if(o&&"string"===typeof o){var c=o.match(nt);if(c){var s="{".concat(c[1],"}").replace(/ /g,", ");try{var u=at.parse(s);t=u.altitude,a=u.latitude,n=u.longitude}catch(d){console.warn("error parsing LPP gsp payload",d,s)}}}return{time:new Date(e.time),deviceId:i,altitude:t,latitude:a,longitude:n,hdop:r,sats:l}}}]),e}();function it(){var e=Object(d.a)(["\n\ttext-align: center;\n\tposition: absolute;\n\tz-index: 100;\n\twidth: 100%;\n"]);return it=function(){return e},e}function rt(){var e=Object(d.a)(["\n\ttext-align: center;\n\tbackground-color: #282c34;\n\tmin-height: 100vh;\n\tfont-size: calc(10px + 2vmin);\n\tcolor: white;\n"]);return rt=function(){return e},e}console.log("production",Object({NODE_ENV:"production",PUBLIC_URL:"/TTN-tracker-locator",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_DEFAULT_MAP_BOX_ACCESS_TOKEN:"pk.eyJ1IjoiYXlhdmlsZXZpY2giLCJhIjoiY2tjbjg0eTZqMDhudTMzcGJzNXEwcTJ2cyJ9.qkxSXBwEn7UeN0vc080EZA",REACT_APP_DEFAULT_TTN_CORS_PROXY_URL:"https://tracker-locator-to-ttn.herokuapp.com/"}));var lt={SETTINGS:"settings",DEMO_LATITUDE_OFFSET:"demo_lat",DEMO_LONGITUDE_OFFSET:"demo_long"},ct=p.a.div(rt()),st=p.a.nav(it()),ut=function(e){Object(s.a)(a,e);var t=Object(u.a)(a);function a(e){var n;Object(l.a)(this,a),(n=t.call(this,e)).handleSettingsFinish=function(e){var t=n.state.googleApiKey;if(e){if(tt.setGoogleApiKey(e.googleApiKey),tt.setMapBoxAccessToken(e.mapBoxAccessToken),tt.setDataSource(e.dataSource),tt.setCustomDataUrl(e.customDataUrl),tt.setTtnApplicationId(e.ttnApplicationId),tt.setTtnDeviceId(e.ttnDeviceId),tt.setTtnAccessKey(e.ttnAccessKey),tt.setTtnCorsProxyUrl(e.ttnCorsProxyUrl),tt.setTtnQueryLast(e.ttnQueryLast),tt.setMaxPointsToRenderOnMap(e.maxPointsToRenderOnMap),t!==e.googleApiKey)return console.log("handleSettingsFinish, reload"),void window.location.reload();n.setState({settingsVisible:!1,googleApiKey:e.googleApiKey,mapBoxAccessToken:e.mapBoxAccessToken,dataSource:e.dataSource,customDataUrl:e.customDataUrl,ttnApplicationId:e.ttnApplicationId,ttnDeviceId:e.ttnDeviceId,ttnAccessKey:e.ttnAccessKey,ttnCorsProxyUrl:e.ttnCorsProxyUrl,ttnQueryLast:e.ttnQueryLast,maxPointsToRenderOnMap:e.maxPointsToRenderOnMap})}else n.setState({settingsVisible:!1})},n.handleLoadData=function(){n.state.loadingData||(console.log("handle fetch"),n.setState({loadingData:!0}),n.fetchData().then((function(e){return e.ok?204===e.status?[]:e.json():(0===e.status?m.a.error({message:"Unable to get response",description:"Are there CORS limitations in place?"}):m.a.error({message:"Error code reported",description:e.statusText}),n.setState({loadingData:!1}),null)})).then((function(e){e&&n.processLocationData(e),n.setState({loadingData:!1})})).catch((function(e){console.error(e),m.a.error({message:"Error loading data",description:e.toString()}),n.setState({loadingData:!1})})))};var o=new f.a,i=0,r=0;if(o.has(lt.DEMO_LATITUDE_OFFSET)&&(i=parseFloat(o.getValue(lt.DEMO_LATITUDE_OFFSET),10)),o.has(lt.DEMO_LONGITUDE_OFFSET)&&(r=parseFloat(o.getValue(lt.DEMO_LONGITUDE_OFFSET),10)),o.has(lt.SETTINGS)){var c=o.getValue(lt.SETTINGS);console.log("loading settings from hash",c),tt.deserialize(decodeURIComponent(c))}var s=tt.getMaxPointsToRenderOnMap();return n.state={loadingData:!1,settingsVisible:!1,pointsTableVisible:!1,points:[],demoLatitudeOffset:i,demoLongitudeOffset:r,googleApiKey:tt.getGoogleApiKey(),mapBoxAccessToken:tt.getMapBoxAccessToken()||"pk.eyJ1IjoiYXlhdmlsZXZpY2giLCJhIjoiY2tjbjg0eTZqMDhudTMzcGJzNXEwcTJ2cyJ9.qkxSXBwEn7UeN0vc080EZA",dataSource:tt.getDataSource(),customDataUrl:tt.getCustomDataUrl(),ttnApplicationId:tt.getTtnApplicationId(),ttnDeviceId:tt.getTtnDeviceId(),ttnAccessKey:tt.getTtnAccessKey(),ttnCorsProxyUrl:tt.getTtnCorsProxyUrl()||"https://tracker-locator-to-ttn.herokuapp.com/",ttnQueryLast:tt.getTtnQueryLast(),maxPointsToRenderOnMap:void 0!==s?parseInt(s,10):s},n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){this.handleLoadData()}},{key:"componentDidUpdate",value:function(e,t){var a=this.state,n=a.dataSource,o=a.customDataUrl,i=a.ttnApplicationId,r=a.ttnDeviceId,l=a.ttnAccessKey,c=a.ttnCorsProxyUrl,s=a.ttnQueryLast;t.dataSource===n&&t.customDataUrl===o&&t.ttnApplicationId===i&&t.ttnDeviceId===r&&t.ttnAccessKey===l&&t.ttnCorsProxyUrl===c&&t.ttnQueryLast===s||this.handleLoadData()}},{key:"processLocationData",value:function(e){console.log("Got data",e.length,e);try{var t=e.map(ot.preProcessSample);this.setState({points:t})}catch(a){m.a.error({message:"Error parsing data",description:a.toString()})}}},{key:"fetchData",value:function(){var e=this.state,t=e.dataSource,a=e.customDataUrl,n=e.ttnApplicationId,o=e.ttnDeviceId,i=e.ttnAccessKey,r=e.ttnCorsProxyUrl,l=e.ttnQueryLast;if(t===ee.DATA_SOURCE.CUSTOM)return fetch(a,{});if(t===ee.DATA_SOURCE.TTN){var c=new Headers;return c.append("Accept","application/json"),c.append("Authorization","key ".concat(i)),fetch("".concat(r,"https://").concat(n,".data.thethingsnetwork.org/api/v2/query/").concat(o,"?last=").concat(l),{headers:c})}return new Promise((function(e,t){t(new Error("Data source is not configured"))}))}},{key:"render",value:function(){var e=this,t=this.state,a=t.loadingData,n=t.settingsVisible,i=t.pointsTableVisible,r=t.points,l=t.googleApiKey,c=t.mapBoxAccessToken,s=t.dataSource,u=t.customDataUrl,d=t.ttnApplicationId,p=t.ttnDeviceId,m=t.ttnAccessKey,f=t.ttnCorsProxyUrl,E=t.ttnQueryLast,T=t.maxPointsToRenderOnMap,v=t.demoLatitudeOffset,y=t.demoLongitudeOffset;return o.a.createElement(ct,null,o.a.createElement(st,null,o.a.createElement(g.a,{loading:a,onClick:this.handleLoadData,icon:o.a.createElement(x,null)},"Reload data"),o.a.createElement(h.a,{placement:"bottom",title:"Data",visible:i,content:o.a.createElement(Ze,{points:r}),trigger:"click",onVisibleChange:function(t){e.setState({pointsTableVisible:t})}},o.a.createElement(g.a,{icon:o.a.createElement(U,null)},"Data")),o.a.createElement(h.a,{placement:"bottom",title:"Settings",visible:n,content:o.a.createElement(Ge,{onFinish:this.handleSettingsFinish,serializedSettings:"".concat(lt.SETTINGS,"=").concat(encodeURIComponent(tt.serialize())),googleApiKey:l,mapBoxAccessToken:c,dataSource:s,customDataUrl:u,ttnApplicationId:d,ttnDeviceId:p,ttnAccessKey:m,ttnCorsProxyUrl:f,ttnQueryLast:E,maxPointsToRenderOnMap:T}),trigger:"click",onVisibleChange:function(){e.setState({settingsVisible:!0})}},o.a.createElement(g.a,{icon:o.a.createElement(w,null)},"Settings"))),o.a.createElement(xe,{googleApiKey:l,mapBoxAccessToken:c,points:r,maxPointsToRenderOnMap:T,demoLatitudeOffset:v,demoLongitudeOffset:y}))}}]),a}(o.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(ut,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[229,1,2]]]);
//# sourceMappingURL=main.0483693d.chunk.js.map